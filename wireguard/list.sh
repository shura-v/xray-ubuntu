#!/bin/bash

set -e

WG_DIR="/etc/wireguard"
WG_CONF="$WG_DIR/wg0.conf"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ WireGuard
if [ ! -f "$WG_CONF" ]; then
  echo "‚ùå –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ WireGuard –Ω–µ –Ω–∞–π–¥–µ–Ω: $WG_CONF"
  exit 1
fi

# –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "üìã –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ WireGuard:"
echo "----------------------------"

grep -A 3 '\[Peer\]' "$WG_CONF" | while read -r line; do
  # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –ø—É–±–ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º –∏ IP-–∞–¥—Ä–µ—Å–æ–º
  if [[ "$line" =~ PublicKey\ =\ (.*) ]]; then
    CLIENT_PUB="${BASH_REMATCH[1]}"
  elif [[ "$line" =~ AllowedIPs\ =\ (.*) ]]; then
    CLIENT_IP="${BASH_REMATCH[1]}"

    CLIENT_NAME="client_$CLIENT_PUB"  # –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ –±—É–¥–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–º –∫–ª—é—á–µ

    echo "–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞: $CLIENT_NAME"
    echo "IP –∫–ª–∏–µ–Ω—Ç–∞: $CLIENT_IP"
    echo "–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞: $CLIENT_PUB"
    echo "–ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É –∫–ª–∏–µ–Ω—Ç–∞: (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ)"
    echo "----------------------------"
  fi
done

echo "‚úÖ –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–≤–µ—Ä—à—ë–Ω!"
